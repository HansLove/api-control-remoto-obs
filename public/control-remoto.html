<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OBS Remote</title>
  <style>
    :root{
      --bg:#0a0e14;
      --surface:rgba(18,26,38,.72);
      --text:#eaf1ff;
      --muted:#7a8ba8;
      --border:rgba(255,255,255,.08);
      --good:#27d17f;
      --warn:#f6c34a;
      --bad:#ff4d6d;
      --accent:#6aa9ff;
      --shadow: 0 8px 24px rgba(0,0,0,.4);
      --radius: 16px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    html,body{margin:0;height:100%;}
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color:var(--text);
      padding: 12px;
      padding-bottom: 88px;
      overflow-x:hidden;
    }
    .wrap{max-width:480px;margin:0 auto;display:flex;flex-direction:column;gap:10px;}
    
    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 4px 12px;
      border-bottom:1px solid var(--border);
      margin-bottom:4px;
    }
    .logo{font-size:15px;font-weight:800;letter-spacing:.3px;}
    .status{
      display:flex;align-items:center;gap:6px;
      font-size:11px;font-weight:600;color:var(--muted);
    }
    .dot{width:8px;height:8px;border-radius:50%;background:var(--warn);}
    .dot.ok{background:var(--good);}
    .dot.bad{background:var(--bad);}

    /* Cards */
    .card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      backdrop-filter:blur(8px);
    }
    .card-title{
      font-size:11px;
      font-weight:700;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.5px;
      margin-bottom:10px;
    }

    /* Buttons */
    .btn{
      width:100%;
      padding:14px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      transition:transform .05s,background .15s;
    }
    .btn:active{transform:scale(.97);}
    .btn.primary{background:rgba(106,169,255,.18);border-color:rgba(106,169,255,.3);}
    .btn.good{background:rgba(39,209,127,.15);border-color:rgba(39,209,127,.25);}
    .btn.bad{background:rgba(255,77,109,.15);border-color:rgba(255,77,109,.25);}
    .btn.warn{background:rgba(246,195,74,.15);border-color:rgba(246,195,74,.25);}
    .btn.ghost{background:transparent;}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}

    /* Quick Toast Input */
    .toast-row{display:flex;gap:8px;}
    .toast-row input{
      flex:1;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    .toast-row input::placeholder{color:var(--muted);}
    .toast-row .btn{width:auto;padding:12px 16px;}

    /* Sequence display */
    .seq-display{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:rgba(0,0,0,.2);
      border-radius:12px;
      margin-bottom:10px;
    }
    .seq-num{font-size:28px;font-weight:900;color:var(--accent);}
    .seq-info{flex:1;}
    .seq-name{font-size:12px;color:var(--muted);font-weight:600;}
    .seq-label{font-size:13px;font-weight:600;margin-top:2px;}

    /* Connection panel (collapsible) */
    .conn-panel{
      overflow:hidden;
      max-height:0;
      transition:max-height .2s ease;
    }
    .conn-panel.open{max-height:200px;}
    .conn-toggle{
      font-size:11px;
      color:var(--muted);
      cursor:pointer;
      text-align:center;
      padding:8px;
    }
    .conn-inner{padding:10px 0;}
    .conn-inner input{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-size:13px;
      outline:none;
      margin-bottom:8px;
    }
    .conn-inner .grid2{margin-top:4px;}

    /* Bottom dock */
    .dock{
      position:fixed;
      left:0;right:0;bottom:0;
      padding:10px 12px 16px;
      background:linear-gradient(to top,rgba(10,14,20,.98),rgba(10,14,20,.7));
      backdrop-filter:blur(10px);
      border-top:1px solid var(--border);
    }
    .dock-inner{max-width:480px;margin:0 auto;display:flex;gap:8px;}
    .dock-inner .btn{flex:1;padding:16px 12px;font-size:15px;border-radius:16px;}

    /* Toast notification */
    .ui-toast{
      position:fixed;
      left:50%;bottom:100px;
      transform:translateX(-50%);
      padding:10px 16px;
      background:rgba(18,26,38,.95);
      border:1px solid var(--border);
      border-radius:12px;
      font-size:13px;
      font-weight:600;
      opacity:0;
      transition:opacity .15s;
      pointer-events:none;
      z-index:100;
    }
    .ui-toast.show{opacity:1;}

    @media(max-width:360px){
      .grid2,.grid3{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">üì° OBS Remote</div>
      <div class="status">
        <span class="dot" id="dot"></span>
        <span id="statusText">Connecting‚Ä¶</span>
      </div>
    </header>

    <!-- Figuras 3D -->
    <div class="card">
      <div class="card-title">üé® Figuras 3D</div>
      <div class="grid2 grid-figuras">
        <button class="btn primary" data-figure="heart">‚ù§Ô∏è Coraz√≥n</button>
        <button class="btn good" data-figure="cone">üî∫ Cono</button>
        <button class="btn warn" data-figure="sphere">üîµ Esfera</button>
        <button class="btn" data-figure="cube">üü¶ Cubo</button>
        <button class="btn" data-figure="torus">üç© Toro</button>
      </div>
    </div>

    <!-- Escritos -->
    <div class="card">
      <div class="card-title">‚úçÔ∏è Escritos</div>
      <div class="grid2" id="escritosGrid"></div>
      <div style="height:8px"></div>
      <div class="toast-row">
        <input id="customText" placeholder="Texto custom‚Ä¶" />
        <button class="btn ghost" id="sendCustomText">Mostrar</button>
      </div>
    </div>

    <!-- Quick Toast -->
    <div class="card">
      <div class="card-title">üí¨ Quick Message</div>
      <div class="toast-row">
        <input id="toastMsg" placeholder="Type a message‚Ä¶" />
        <button class="btn primary" id="sendToast">Send</button>
      </div>
    </div>

    <!-- Markers -->
    <div class="card">
      <div class="card-title">üé¨ Markers</div>
      <div class="grid2">
        <button class="btn good" data-trigger="applause">üëè Applause</button>
        <button class="btn bad" data-trigger="disagree">‚ùå Disagree</button>
        <button class="btn warn" data-trigger="wtf">üò≥ WTF</button>
        <button class="btn primary" data-trigger="highlight">üî• Highlight</button>
      </div>
      <div style="height:8px"></div>
      <div class="grid2">
        <button class="btn ghost" data-trigger="keypoint">üß† Key Point</button>
        <button class="btn ghost" data-trigger="funny">üòÇ Funny</button>
      </div>
    </div>

    <!-- Sequences -->
    <div class="card">
      <div class="card-title">üìä Sequence</div>
      <div class="seq-display">
        <div class="seq-num" id="seqNum">‚Äî</div>
        <div class="seq-info">
          <div class="seq-name" id="seqName">TOP 5</div>
          <div class="seq-label" id="seqLabel">Click Next to start</div>
        </div>
      </div>
      <div class="grid3">
        <button class="btn primary" id="seqNext">‚ñ∂ Next</button>
        <button class="btn ghost" id="seqBack">‚Ü© Back</button>
        <button class="btn ghost" id="seqReset">‚ü≤ Reset</button>
      </div>
    </div>

    <!-- Spoiler Modes -->
    <div class="card">
      <div class="card-title">‚ö†Ô∏è Spoiler Level</div>
      <div class="grid3">
        <button class="btn good" data-spoiler="safe">üîí Safe</button>
        <button class="btn warn" data-spoiler="light">‚ö†Ô∏è Light</button>
        <button class="btn bad" data-spoiler="full">‚ò†Ô∏è Full</button>
      </div>
    </div>

    <!-- Connection Settings (collapsed by default) -->
    <div class="conn-toggle" id="connToggle">‚öôÔ∏è Connection Settings</div>
    <div class="conn-panel" id="connPanel">
      <div class="conn-inner">
        <input id="wsUrl" placeholder="wss://obs-control-aaron.herokuapp.com" />
        <input id="token" placeholder="Token (default: elias123)" />
        <div class="grid2">
          <button class="btn primary" id="connectBtn">Connect</button>
          <button class="btn ghost" id="disconnectBtn">Disconnect</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Dock -->
  <div class="dock">
    <div class="dock-inner">
      <button class="btn primary" id="bigHighlight">üî• Highlight</button>
      <button class="btn warn" id="bigNext">‚è≠Ô∏è Next</button>
    </div>
  </div>

  <div class="ui-toast" id="toast"></div>

<script>
(() => {
  const $ = id => document.getElementById(id);
  
  // ========== CONFIG ==========
  const DEFAULT_TOKEN = "elias123";
  const FRASES = [
    "Amor y amistad",
    "Feliz d√≠a del amor",
    "Gracias por estar",
    "Vibe coding con coraz√≥n",
    "Pensamientos que unen",
    "Celebramos juntos",
    "Con cari√±o",
    "La amistad es amor elegido"
  ];

  // ========== State ==========
  const state = {
    ws: null,
    connected: false,
    seq: { name: "top5", step: 0, max: 5, label: "" }
  };
  
  const SETTINGS_KEY = "obs_remote_v2";

  // ========== Auto-detect WebSocket URL ==========
  function isOnServer() {
    return location.protocol !== "file:" && location.hostname !== "localhost";
  }
  
  function getAutoWsUrl() {
    if (isOnServer()) {
      const protocol = location.protocol === "https:" ? "wss:" : "ws:";
      return `${protocol}//${location.host}`;
    }
    return null; // Need manual config
  }
  
  function getDefaultToken() {
    // Use default token when on server, otherwise use saved or empty
    return isOnServer() ? DEFAULT_TOKEN : "";
  }

  // ========== UI Helpers ==========
  function toast(msg, duration = 1200) {
    const el = $("toast");
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(toast._t);
    toast._t = setTimeout(() => el.classList.remove("show"), duration);
  }

  function setStatus(ok, text) {
    $("dot").className = "dot " + (ok ? "ok" : "bad");
    $("statusText").textContent = text;
  }

  function updateSeqDisplay() {
    const { step, max, name, label } = state.seq;
    const seqNumEl = $("seqNum");
    const seqLabelEl = $("seqLabel");
    const seqNameEl = $("seqName");
    if (!seqNumEl || !seqLabelEl || !seqNameEl) return;
    if (step === 0) {
      seqNumEl.textContent = "‚Äî";
      seqLabelEl.textContent = "Click Next to start";
    } else {
      const display = name === "top5" ? `#${max - step + 1}` : step;
      seqNumEl.textContent = display;
      seqLabelEl.textContent = label || `Step ${step} of ${max}`;
    }
    seqNameEl.textContent = name.toUpperCase().replace("TOP5", "TOP 5");
  }

  // ========== Settings ==========
  function loadSettings() {
    try {
      const s = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "{}");
      const wsUrlEl = $("wsUrl");
      const tokenEl = $("token");
      if (s.wsUrl && wsUrlEl) wsUrlEl.value = s.wsUrl;
      if (s.token && tokenEl) tokenEl.value = s.token;
    } catch (_) {}
  }

  function saveSettings() {
    try {
      const wsUrlEl = $("wsUrl");
      const tokenEl = $("token");
      localStorage.setItem(SETTINGS_KEY, JSON.stringify({
        wsUrl: (wsUrlEl && wsUrlEl.value) ? wsUrlEl.value.trim() : "",
        token: (tokenEl && tokenEl.value) ? tokenEl.value.trim() : ""
      }));
    } catch (_) {}
  }

  // ========== WebSocket ==========
  function connect(url, token) {
    if (state.ws) state.ws.close();
    
    let wsUrl = url || $("wsUrl").value.trim() || getAutoWsUrl();
    const wsToken = token ?? $("token").value.trim();
    
    if (!wsUrl) {
      setStatus(false, "No URL");
      $("connPanel").classList.add("open");
      return;
    }
    
    if (wsToken) {
      wsUrl += (wsUrl.includes("?") ? "&" : "?") + "token=" + encodeURIComponent(wsToken);
    }

    try {
      state.ws = new WebSocket(wsUrl);
      setStatus(false, "Connecting‚Ä¶");

      state.ws.onopen = () => {
        state.connected = true;
        setStatus(true, "Connected");
        toast("‚úì Connected");
        saveSettings();
      };

      state.ws.onclose = (e) => {
        state.connected = false;
        if (e.code === 1008) {
          setStatus(false, "Auth Failed");
          toast("Token invalid", 2000);
          $("connPanel").classList.add("open");
        } else {
          setStatus(false, "Disconnected");
        }
      };

      state.ws.onerror = () => {
        state.connected = false;
        setStatus(false, "Error");
      };

      state.ws.onmessage = (e) => {
        try {
          const msg = JSON.parse(e.data);
          if (msg.type === "ack") toast("‚úì Sent");
        } catch {}
      };
    } catch {
      setStatus(false, "Failed");
    }
  }

  function send(payload) {
    if (state.ws?.readyState === 1) {
      state.ws.send(JSON.stringify({
        ts: new Date().toISOString(),
        ...payload
      }));
    } else {
      toast("Not connected", 1500);
    }
  }

  // ========== Actions ==========
  function sendToast() {
    const msg = $("toastMsg").value.trim();
    if (!msg) return toast("Type a message");
    send({ type: "toast", toast: { message: msg, variant: "info", durationMs: 2500 } });
    $("toastMsg").value = "";
  }

  function sendMarker(trigger) {
    send({ type: "marker", trigger, label: trigger });
  }

  function sendSpoiler(level) {
    send({ type: "spoiler", level });
    toast(`Spoiler: ${level}`);
  }

  function seqNext() {
    if (state.seq.step < state.seq.max) {
      state.seq.step++;
    } else {
      state.seq.step = 1; // Loop
    }
    updateSeqDisplay();
    send({ type: "sequence", action: "next", seq: state.seq });
  }

  function seqBack() {
    if (state.seq.step > 1) state.seq.step--;
    updateSeqDisplay();
    send({ type: "sequence", action: "back", seq: state.seq });
  }

  function seqReset() {
    state.seq.step = 0;
    updateSeqDisplay();
    send({ type: "sequence", action: "reset", seq: state.seq });
  }

  function sendSceneFigure(figure) {
    send({ type: "scene", figure });
  }

  function sendScenePhrase(phraseId) {
    send({ type: "scene", phraseId });
  }

  function sendSceneText(text) {
    send({ type: "scene", text: text.trim() });
  }

  // ========== Event Listeners ==========
  function wire() {
    // Figuras 3D
    document.querySelectorAll("[data-figure]").forEach(btn => {
      btn.onclick = () => sendSceneFigure(btn.dataset.figure);
    });

    // Escritos: build buttons from FRASES
    const escritosGrid = $("escritosGrid");
    if (escritosGrid) {
      FRASES.forEach((texto, i) => {
        const btn = document.createElement("button");
        btn.className = "btn ghost";
        btn.textContent = texto.length > 18 ? texto.slice(0, 18) + "‚Ä¶" : texto;
        btn.dataset.phraseId = String(i);
        btn.onclick = () => sendScenePhrase(i);
        escritosGrid.appendChild(btn);
      });
    }
    const sendCustomTextBtn = $("sendCustomText");
    if (sendCustomTextBtn) {
      sendCustomTextBtn.onclick = () => {
        const v = ($("customText") && $("customText").value) ? $("customText").value.trim() : "";
        if (v) sendSceneText(v);
        else toast("Escribe un texto");
      };
    }

    // Toast
    const sendToastBtn = $("sendToast");
    if (sendToastBtn) sendToastBtn.onclick = sendToast;
    const toastMsgEl = $("toastMsg");
    if (toastMsgEl) toastMsgEl.onkeydown = (e) => { if (e.key === "Enter") sendToast(); };

    // Markers
    document.querySelectorAll("[data-trigger]").forEach(btn => {
      btn.onclick = () => sendMarker(btn.dataset.trigger);
    });

    // Spoilers
    document.querySelectorAll("[data-spoiler]").forEach(btn => {
      btn.onclick = () => sendSpoiler(btn.dataset.spoiler);
    });

    // Sequences
    const seqNextEl = $("seqNext");
    if (seqNextEl) seqNextEl.onclick = seqNext;
    const seqBackEl = $("seqBack");
    if (seqBackEl) seqBackEl.onclick = seqBack;
    const seqResetEl = $("seqReset");
    if (seqResetEl) seqResetEl.onclick = seqReset;

    // Dock
    const bigHighlightEl = $("bigHighlight");
    if (bigHighlightEl) bigHighlightEl.onclick = () => sendMarker("highlight");
    const bigNextEl = $("bigNext");
    if (bigNextEl) bigNextEl.onclick = () => sendMarker("next_segment");

    // Connection panel toggle
    const connToggleEl = $("connToggle");
    if (connToggleEl) {
      connToggleEl.onclick = () => {
        const p = $("connPanel");
        if (p) p.classList.toggle("open");
      };
    }

    // Connection buttons
    const connectBtnEl = $("connectBtn");
    if (connectBtnEl) connectBtnEl.onclick = () => connect();
    const disconnectBtnEl = $("disconnectBtn");
    if (disconnectBtnEl) {
      disconnectBtnEl.onclick = () => {
        if (state.ws) state.ws.close();
        setStatus(false, "Disconnected");
      };
    }

    // Save on input
    const wsUrlEl = $("wsUrl");
    if (wsUrlEl) wsUrlEl.onchange = saveSettings;
    const tokenEl = $("token");
    if (tokenEl) tokenEl.onchange = saveSettings;
  }

  // ========== Boot ==========
  loadSettings();
  wire();
  updateSeqDisplay();

  // Auto-connect if on server
  const autoUrl = getAutoWsUrl();
  if (autoUrl) {
    // Use saved token or default token
    const token = $("token").value.trim() || getDefaultToken();
    if (!$("token").value.trim() && token) {
      $("token").value = token; // Show default in input
    }
    connect(autoUrl, token);
  } else {
    setStatus(false, "Manual");
    $("connPanel").classList.add("open");
  }
})();
</script>
</body>
</html>
